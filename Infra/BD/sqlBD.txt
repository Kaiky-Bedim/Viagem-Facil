create database ViagemFacil_DB;
use ViagemFacil_DB;

#Vamos criptografar o CPF e a Senha, por isso os dois são varchar de 50, o SHA gera um Hash de 40 caracteres
create table Senhas(
CPF varchar(50) PRIMARY KEY NOT NULL,
Senha varchar(50) NOT NULL
);

create table DadosCadastrais(
CPF varchar(11) PRIMARY KEY NOT NULL,
RG varchar(9) NOT NULL,
Nome varchar(50) NOT NULL,
DataNascimento varchar(10) NOT NULL,
Telefone1 varchar(11) NOT NULL,
Telefone2 varchar(11),
Email varchar(50) NOT NULL,
Estado varchar(5) not null,
Cidade varchar(50) not null,
Rua varchar(50) not null,
Complemento varchar(50),
Numero int not null,
CEP varchar(10) not null
);

create table Cartao(
NumeroSerie varchar(7) NOT NULL,
NumeroFabrica varchar(9) NOT NULL,
TipoCartao varchar(50) NOT NULL,
Situacao varchar(30) NOT NULL,
Empresa varchar(30) NOT NULL,
Bloqueado boolean NOT NULL,
CPFProprietario varchar(11) NOT NULL,
Saldo double NOT NULL,
FOREIGN KEY (CPFProprietario) REFERENCES DadosCadastrais (CPF),
CHECK (TipoCartao <=> "Normal" or TipoCartao <=> "Estudantil" or TipoCartao <=> "Idoso"),
CHECK (Situacao <=> "Aprovado" or Situacao <=> "Reprovado" or Situacao <=> "Aguardando"),
CHECK (Empresa <=> "Maringá do Vale" or Empresa <=> "Viação Jacareí"),
CONSTRAINT AssinaturaCartao PRIMARY KEY(NumeroSerie, Empresa)
);

create table Percursos(
Id int PRIMARY KEY NOT NULL AUTO_INCREMENT,
NumeroLinha int NOT NULL,
Trecho varchar(50) NOT NULL,
Veiculo varchar(50) NOT NULL
);

create table Movimentacoes(
Id int PRIMARY KEY NOT NULL AUTO_INCREMENT,
Valor double NOT NULL,
DataMovimentacao datetime NOT NULL,
TipoMovimentacao varchar(30) NOT NULL,
NumeroSerieCartao varchar(7) NOT NULL,
Id_Percurso int,
FOREIGN KEY (NumeroSerieCartao) REFERENCES Cartao (NumeroSerie),
FOREIGN KEY (Id_Percurso) REFERENCES Percursos (Id),
CHECK (TipoMovimentacao <=> "Recarga" or TipoMovimentacao <=> "Utilização em ônibus")
);